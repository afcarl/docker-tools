#!/bin/bash
## Looks into current Folder installs systemd *.service files accepts path as arg
shopt -s nullglob
# shopt -s dotglob # To include hidden files
if [ ! -z "$1" ]; 
 then
  files=(${1}/*.service)
  # Check if we find service files in this dir
  if [ ${#files[@]} -gt 0 ]; 
   then 
    cd $1; 
   else
     echo "Failed: no systemd services found in $1 \n usage: systemctl-inst /path/to/*.service files or or move into the dir i tested current $PWD";
     exit 1
  fi;
fi;

  # Check if we find service files in current dir
  files=(${PWD}/*.service)
  if [ ${#files[@]} -gt 0 ]; 
   then 
    echo "Installing $(echo $(ls *.service)) from $PWD to /lib/systemd/system";
    # Removing old if exist
    if [ ! -z "$2" ]; then
     ls *.service | xargs -i -n1 rm -f /lib/systemd/system/{}
     ls *.service | xargs -i -n1 find /etc/systemd -name "{}" -print0 | xargs -0 rm -f
    fi;
    # Installing services into systemd repo/usr/lib/systemd/system-preset/
     rsync -Luavh --progress ${PWD}/*.service  /lib/systemd/system;
     rsync -Luavh --progress ${PWD}/*.presets  /usr/lib/systemd/system-preset/;
     
    systemctl daemon-reload;
    # Activating
    ls *.service | xargs -n1 systemctl enable
    ls *.service | xargs -n1 systemctl start
    systemctl daemon-reload;
    exit 0; 
  fi;
  
  #files=(${PWD}/bin/*)
  #if [ ${#files[@]} -gt 0 ]; 
  # then 
  #  echo "Installing $(echo $(ls bin/*)) from $PWD to /usr/bin";
    # Removing old if exist
  #  if [ ! -z "$2" ]; then
  #   ls bin/* | xargs -i -n1 rm -f /usr/bin/{}
  #   ls bin/* | xargs -i -n1 find /usr/bin -name "{}" -print0 | xargs -0 rm -f
  #  fi;
    # Installing services into systemd repo
  #   rsync -Luavh --progress ${PWD}/bin/*  /usr/bin;
    # Activating
  #  echo "installed bins:"
  #  ls bin/*
  #  exit 0; 
  #fi;
 
