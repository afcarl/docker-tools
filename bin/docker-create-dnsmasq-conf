#!/bin/bash

# Copyright 2014 Frank Lemanschik Direkt SPEED 
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# http://www.apache.org/licenses/LICENSE-2.0
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

### Creates a file in /etc/dnsmasq.d for a docker container this script takes one arg the id
# TODO:
# Check if container exists!
#
# Arg1 = Container name / id 
THIS_CID="${1}"
THIS_IP=$(docker inspect $THIS_CID | grep IPAddress | cut -f4 -d'"')
THIS_HOSTNAME=$(docker inspect $THIS_CID | grep '"Hostname"' | cut -f4 -d '"')
THIS_DOMAIN=$(docker inspect $THIS_CID | grep Domainname | cut -f4 -d '"')
THIS_FQDN="${THIS_HOSTNAME}.${THIS_DOMAIN}"
THIS_ADRLINE1="address=/${THIS_FQDN}/$THIS_IP"
THIS_ADRLINE2="# THIS_DOCKER $THIS_CID "
echo $THIS_ADRLINE1 > /etc/dnsmasq.d/0host_$THIS_CID
echo $THIS_ADRLINE2 >> /etc/dnsmasq.d/0host_$THIS_CID
echo $THIS_ADRLINE1 
echo $THIS_ADRLINE2
